## OpenViking：面向 Agent 的上下文数据库

## 核心观点

**OpenViking 是专为 AI Agent 设计的开源上下文数据库**，采用"文件系统范式"统一管理记忆、资源和技能，通过分层上下文加载、目录递归检索和可观测自迭代机制，解决传统 RAG 的碎片化、高成本和黑箱问题。

------

## 背景：上下文管理的困境

随着模型能力飞速提升，Agent 从简单的任务执行者演变为能够感知环境、自主规划、调用工具完成复杂目标的智能实体。然而，开发者们普遍遭遇了上下文管理这座难以逾越的冰山。

**当前面临的核心问题：**

| 问题                       | 说明                                                         |
| -------------------------- | ------------------------------------------------------------ |
| **上下文无序且割裂**       | 记忆在代码中，资源在向量库，技能分散在各个角落，关联和维护成本极高 |
| **长程任务需要更多上下文** | 简单截断或压缩本质上是"丢卒保帅"，带来不可逆的信息损失和高昂成本 |
| **朴素 RAG 检索效果局限**  | 平铺式存储缺乏全局视野，过于关注语义相关性，在需要泛化和探索的场景中表现不佳 |
| **上下文缺乏观测和调试**   | 传统 RAG 隐式检索链路如同黑箱，出错时难以归因和调试          |
| **记忆成为核心资产**       | Agent 的核心资产包括用户记忆和 Agent 自身的经验偏好，需要形成复利效果 |

业界已有一些探索实践：Manus 提出文件系统是上下文的终极形态；Claude Code 验证了文件系统 + Bash 的简洁方案；Anthropic 的 Skills 系统以文件夹组织能力模块。但缺乏一个类似数据库能有效管理 Agent 所需所有上下文的解决方案。

------

## OpenViking 核心理念

OpenViking 摒弃了传统 RAG 的碎片化向量存储模式，创新性地采用"文件系统范式"，将 Agent 所需的记忆、资源和技能进行统一的结构化组织。



### 1. 文件系统管理范式

将上下文统一抽象并组织于虚拟文件系统中，所有内容映射到 `viking://` 协议下的虚拟目录，拥有唯一的 URI。Agent 可以通过 `list`、`find` 等标准指令精确、确定性地定位、浏览和操作信息，让上下文管理从模糊的语义匹配演变为直观、可追溯的"文件操作"。

![文件系统管理范式](image/openviking1.gif)

### 2. 分层上下文按需加载

将海量上下文一次性塞入提示词不仅成本高昂，更容易超出模型窗口并引入噪声。OpenViking 在上下文写入时自动将其处理为三个层级：

| 层级          | 内容                   | 用途               |
| ------------- | ---------------------- | ------------------ |
| **L0 (摘要)** | 一句话概括             | 快速判断           |
| **L1 (概述)** | 包含核心信息和使用场景 | Agent 规划阶段决策 |
| **L2 (详情)** | 完整的原始数据         | 深入读取           |

![分层上下文按需加载](image/openviking2.gif)

### 3. 目录递归检索

创新的检索策略深度融合多种检索方式：

1. **意图分析**：生成多个检索条件
2. **向量检索**：快速定位初始切片所在的高分目录
3. **二次检索**：在该目录下进行检索，更新候选集合
4. **逐层递归**：若目录下存在子目录，重复二次检索步骤

"先锁定高分目录、再精细探索内容"的策略，不仅能找到语义最匹配的片段，更能理解信息所在的完整语境，提升检索的全局性与准确性。

![目录递归检索](image/openviking4.gif)


### 4. 可观测与自迭代

- **可视化检索轨迹**：目录浏览、文件定位轨迹被完整留存，能够清晰观测问题根源并指导检索逻辑优化
- **记忆自迭代闭环**：每次会话结束时通过 `session.commit()` 主动触发，系统异步分析任务执行结果与用户反馈，自动更新至 User 和 Agent 的 `/memory` 目录下，让 Agent "越用越聪明"

![可观测与自迭代](image/openviking3.gif)
